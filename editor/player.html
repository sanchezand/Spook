<html>
	<head>
		<script src="js/editor.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.7.1/semantic.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.7.6/semantic.min.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.6/ace.js" integrity="sha256-CVkji/u32aj2TeC+D13f7scFSIfphw2pmu4LaKWMSY8=" crossorigin="anonymous"></script>
		<title>Player - Spook</title>
	</head>
	<style>
		body{
			width: 100%;
		}
		.sp.canvas{
			width: 405px;
			height: 405px;
			border: 1px solid black;
			margin: auto;
		}
		.player{
			max-width: 500px;
			text-align: center;
		}
		.player .buttons{
			margin-top: 10px;
		}
		.player .link{
			margin-top: 10px;
		}
		.container{
			display: flex;
			justify-content: center;
			margin-top: 20px;
		}
		.container .editor{
			margin-left: 20px;
			max-width: 700px;
			width: 100%;
		}
	</style>
	<body>
		<div class="container">
			<div class="player">
				<canvas class="sp canvas" width="405" height="405" id="canvas" oncontextmenu="return false;"></canvas>
				<div class="buttons">
					<div class="ui green button icon" style="width: 200px;">
						<i class="play icon"></i> Ejecutar
					</div>
					<br>
					<div class="ui icon button" onclick="setPlayer()" style="margin-top: 10px; width: 200px;">
						<i class="edit icon"></i> Abrir en editor
					</div>
				</div>
				<div class="ui link form">
					<div class="field">
						<label>Play Link</label>
						<div class="ui input action right">
							<input type="text" id="link-play">
							<div class="ui button">
								Abrir
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="editor" id="editor">fun start()

end</div>
		</div>
	</body>
	<script>
		var editor = new Editor(document.getElementById("canvas"));
		editor.start();
		editor.setMode(5);
		
		$('#link-play').val(location.href);
		
		var urlParams = new URLSearchParams(window.location.search);
		var walls = urlParams.get('w');
		var boxes = urlParams.get('b');
		var player = urlParams.get('p');
		var ending = urlParams.get('e');
		
		if(boxes){
			var b = boxes.split(';');
			for(var i of b){
				var s = i.split(',');
				editor.placeBox(s[0], s[1], false, s[2]);
			}
		}
		if(walls){
			var w = walls.split(';');
			for(var i of w){
				var s = i.split(',');
				if(s[0]=='x'){
					editor.placeWall(s[1], s[2], s[1], s[3]);
				}else{
					editor.placeWall(s[2], s[1], s[3], s[1]);
				}
			}
		}
		if(player){
			var s = player.split(',');
			editor.placePlayer(s[0], s[1], s[2]);
		}
		if(ending){
			var s = ending.split(',');
			editor.placeEnd(s[0], s[1]);
		}

		var ace_editor = ace.edit("editor");
		ace_editor.setTheme("ace/theme/monokai");

		
	</script>
</html>